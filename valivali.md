# Documentation for the `valivali` package.
  
----------------------------------------------------------------
 
 *valivali - validation toolbox -* 
  
----------------------------------------------------------------
 
### Version information:
  
- Package: valivali
- Version: 0.2.1
- Generated: 2025-12-02T14:54:58
- Author(s): PharmaForest
- Maintainer(s): PharmaForest
- License: MIT
- File SHA256: `F*6E424C70979E40E37DDB73FF1924FFC1D83F5D0D665B1AEF8322774FF5563728` for this version
- Content SHA256: `C*66AC3D38143F1F49A509F9AD692DFFEE19D29B50FFB602D5ABFE3FCF9439913E` for this version
  
---
 
# The `valivali` package, version: `0.2.1`;
  
---
 

##  valivali
**A SAS package to support validation tasks**

Valivali is a validation toolbox that provides utilities to test and validate SAS packages.  
Use it during package creation and verification to ensure expected behavior and reproducible results.  
Valivali loads {sasjscore} package developed by Allan Bowe when valivali is loaded and strongly influenced and powered by {sasjscore}.  
By loading valivali, users can utilize valivali original macros in addition to {sasjscore} macros for validation.  

Available macros for validations are as below.
- %mp_assertdataset	: To see datasets are equal by proc compare    
- %mp_assertgraph		: To prepare graph information for validation report     
- %mp_assert				: To see if condition is TRUE (from sasjscore)  
- %mp_assertcols		: To see if columns(variables) are in expected condition (from sasjscore)    
- %mp_assertcolvals	: To see if values in variables are in expected condition (from sasjscore)  
- %mp_assertdsobs		: To see if # of observations is in expected condition (from sasjscore)  
- %mp_assertscope		: To check macro scope (from sasjscore)    
- %set_tmp_lib				: To assign temporary libref for common location of Windows and other(Linux or Unix)  
- %create_report			: To create validation report rtf  


### Usage
For more details, please visit
- https://github.com/PharmaForest/valivali  
- https://github.com/SASPAC/sasjscore  

---

  
---
 
  
---
 
Required SAS Components: 
  - Base SAS Software
  
---
 
Required SAS Packages: 
  - sasjscore
  
---
 
 
--------------------------------------------------------------------
 
*SAS package generated by SAS Package Framework, version `20251017`*
 
--------------------------------------------------------------------
 
# The `valivali` package content
The `valivali` package consists of the following content:
 
1. [`%create_report()` macro ](#createreport-macro-1 )
2. [`%mp_assertdataset()` macro ](#mpassertdataset-macro-2 )
3. [`%mp_assertgraph()` macro ](#mpassertgraph-macro-3 )
4. [`%set_tmp_lib()` macro ](#settmplib-macro-4 )
  
 
5. [License note](#license)
  
---
 
## `%create_report()` macro <a name="createreport-macro-1"></a> ######

### Macro:

    %create_report

### Purpose:

    Generates an RTF/PDF **Validation Report** using ODS RTF/PDF and PROC ODSTEXT/PROC REPORT.
    Reads *description.sas* from a SAS Package source folder (via `sourcelocation`)
    to display package name, version, and required packages in the header.

### Parameters:

- `sourcelocation` (optional): Path to a SAS package **source folder** containing `description.sas`.  
  If blank, the header shows placeholder values for Package/Version/ReqPackages.  

- `reporter` (required): Person responsible for the report, printed under the title.  

- `general` (optional): Introductory remarks shown in the *General Information* section.  

- `requirements` (optional): Bullet-like text for the *Requirements* section. Supports `^{newline}` escapes.  

- `results` (optional): Dataset name with three columns: `test_description`, `test_result` (`PASS`/`FAIL`), and `test_comments`.  
  If not provided, the macro creates a small `dummy_results` dataset.  

- `additional` (optional): Free text printed in the *Additional comments* section.  

- `references` (optional): Reference URLs or document titles, each separated with `^{newline}`.  

- `outfilelocation` (required): Existing folder path where the RTF/PDF file will be written.  
   ** Note: `outrtflocation` was used by v0.1.0. Changed arguement name to cover RTF and PDF. It is kept in use in pallalel with the new arguement.  

### Sample code:

~~~sas

%create_report(
  outfilelocation = C:\Temp
) ;

%create_report(
  sourcelocation = C\Temp\mypackage ,
  reporter = John,
  general  = %nrstr(Validation of reporting utilities.),
  requirements = %nrstr(
   - %<check_1> ^{newline}
    Confirm macro variable resolution. ^{newline}
   - %<check_2> ^{newline}
    Confirm date formatting and newline rendering.
  ),
  results = temp.mypackage_test,
  additional = %nrstr(No additional comments.),
  references = %nrstr(
    https://company.example/validation ^{newline}
    Document reference
  ),
  outfilelocation = C:\Temp
);

~~~

### Notes:

 - In case of reporting results from %assertgraph(), 300 px x 300 px or smaller is desirable to place two graphs in a row.
   %create_report() will output graphs stored in locations which are described in `gpath1` and `gpath2` in %assertgraph().

### URL:
https://github.com/PharmaForest/valivali

---

Author:                 Ryo Nakaya
Latest update Date: 2025-12-02

---

  
---
 
## `%mp_assertdataset()` macro <a name="mpassertdataset-macro-2"></a> ######

### Macro:

    %mp_assertdataset

### Purpose:

    Compares two SAS data sets using `PROC COMPARE` and asserts equality. Writes a concise PASS/FAIL
    message to the SAS log and optionally appends a row to an output results data set.

### Parameters:

 - `base` (required): Data set used as BASE in PROC COMPARE.

 - `compare` (required): Data set used as COMPARE in PROC COMPARE.

 - `desc` (optional): Free-text description of the assertion; stored in the output table when `outds` is set.  

 - `puttolog` (optional, default=Y): To switch put NOTE and ERROR of PASS/FAIL into log  
    (Can change to puttolog=N if FAIL is expected in test)  

 - `id` (optional): ID variable list for PROC COMPARE (e.g., `id=USUBJID`).

 - `by` (optional): BY variable list for PROC COMPARE (e.g., `by=USUBJID VISIT`).

 - `criterion` (optional, default=0): Tolerance for comparisons (PROC COMPARE `criterion=`).

 - `method` (optional, default=absolute): Comparison method (PROC COMPARE `method=`).

 - `outds` (optional, default=work.test_results): Results table to append a PASS/FAIL record.

### Returns:

    Creates/updates the data set named in `outds`, prints PASS/FAIL to the log.

### Sample code:

~~~sas
%mp_assertdataset(
  base=work.adsl_expected,
  compare=work.adsl_actual,
  desc=Check ADSL content matches,
  puttolog=Y,
  id=USUBJID,
  by=USUBJID VISIT,
  criterion=1e-12,
  method=absolute,
  outds=work.unit_test_results
);
~~~
### Notes:

 - `NE` (number of diffs) from PROC COMPARE is used to determine PASS (NE=0) or FAIL (NE>0).

### URL:

https://github.com/PharmaForest/valivali

---
Author:                 Ryo Nakaya
Latest update Date: 2025-11-21
---

  
---
 
## `%mp_assertgraph()` macro <a name="mpassertgraph-macro-3"></a> ######

### Macro:
    %mp_assertgraph

### Purpose:
    Assertion macro for graph comparison.
    It checks whether two graph files exist at the given paths (gpath1 and gpath2)
    before they are used to display graphs side by side in the report.

### Parameters:

 - `gpath1` (Conditionally required)  
      Full path to the first graph file to be checked. Either gpath1 or gpath2 should exist.

 - `gpath2` (Conditionally required)  
      Full path to the second graph file to be checked. Either gpath1 or gpath2 should exist.

 - `desc` (optional)  
      Free-text description of the assertion.  
      Stored in the output data set if `outds` is specified.

 - `outds` (optional, default=work.test_results)  
      Results table to append a CHECK record.

### Returns:

 - Creates/updates the data set named in `outds`, prints CHECK to the log.  
 - Variable `test_target` and `test_ID` will be created if `test_description` begins with () [].
   (e.g. description of (%macroname1) [test01] xxxxx, test_target=%macroname1, test_ID=test01)  

### Sample code:

~~~sas
%mp_assertgraph(
  gpath1 = /path/to/graph1.png,
  gpath2 = /path/to/graph2.png,
  desc   = Checking two graphs exist before side-by-side display,
  outds  = work.graph_checks
);
~~~

### URL:

https://github.com/PharmaForest/valivali

---
Author:                 Ryo Nakaya
Latest update Date: 2025-11-21
---

  
---
 
## `%set_tmp_lib()` macro <a name="settmplib-macro-4"></a> ######

### Macro:

    %set_tmp_lib

### Purpose:

    Create libref of TEMP(by default) for specific location based on Windows or else(Linux, Unix)

### Parameters:

 - `lib` (optional, default=TEMP): Library name to assign. 

 - `winpath` (optional, default=C:\Temp): Location for windows  

 - `otherpath` (optional, default=/tmp): Location for other OS(Linux, Unix)  

 - `newfolder` (optional): New folder in the path  

### Returns:

    libref for location or new folder in location (if newfolder is specified)   

### Sample code:

~~~sas
%set_tmp_lib(
  lib=TEMP,
  winpath=C:\Temp,
  otherpath=/tmp,
  newfolder=test
);
~~~
### Notes:

 - Default paths are typical paths

### URL:

https://github.com/PharmaForest/valivali

---
Author:                 Ryo Nakaya
Latest update Date: 2025-10-30
---

  
---
 
  
---
 
# License <a name="license"></a> ######
 
MIT License

Copyright (c) 2025 PharmaForest

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
  
---
 
